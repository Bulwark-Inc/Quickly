{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Bank Transfer Payment | Quickly{% endblock %}
{% block back_button_link %}{% url 'submit_payment' %}{% endblock %}
{% block back_button_text %}Back to Payment Page{% endblock %}

{% block content %}
<section class="min-h-screen bg-gray-50 dark:bg-gray-900 py-16 px-6" data-aos="fade-up">
  <div class="max-w-3xl mx-auto space-y-12">

    <!-- Page Heading -->
    <header class="text-center space-y-2">
      <i data-lucide="banknote" class="w-10 h-10 text-blue-600 dark:text-blue-400 mx-auto"></i>
      <h2 class="text-3xl font-bold text-gray-800 dark:text-white">Bank Transfer Payment</h2>
      <p class="text-sm text-gray-600 dark:text-gray-400">Transfer the exact amount and upload proof below</p>
    </header>

    <!-- Bank Info -->
    <div class="bg-blue-50 dark:bg-blue-900 border border-blue-300 dark:border-blue-700 rounded-lg p-6 text-blue-900 dark:text-blue-200 shadow-sm">
      <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">
        <i data-lucide="building-bank" class="w-5 h-5"></i>
        Bank Account Information
      </h3>
      <dl class="space-y-3 text-sm md:text-base">
        <div class="flex justify-between items-center">
          <dt class="font-medium">Account Name:</dt>
          <dd>Shiloh Egwuatu</dd>
        </div>
        <div class="flex justify-between items-center">
          <dt class="font-medium">Account Number:</dt>
          <dd>3197613167</dd>
        </div>
        <div class="flex justify-between items-center">
          <dt class="font-medium">Bank:</dt>
          <dd>First Bank</dd>
        </div>
        <div class="flex justify-between items-center mt-4 pt-4 border-t border-blue-300 dark:border-blue-700 font-semibold text-lg">
          <dt class="flex items-center gap-2">
            Amount to Pay:

            {% with fees|length as fee_count %}
              <span class="inline-block text-xs px-2 py-0.5 rounded-full font-semibold
                          {% if fee_count == 1 %}
                            bg-yellow-100 text-blue-800 dark:bg-yellow-800 dark:text-blue-100
                          {% elif fee_count == 2 %}
                            bg-blue-100 text-green-800 dark:bg-blue-800 dark:text-green-100
                          {% else %}
                            bg-green-100 text-yellow-800 dark:bg-green-800 dark:text-yellow-100
                          {% endif %}
              ">
                {% if fee_count == 1 %}
                  1
                {% elif fee_count == 2 %}
                  2
                {% else %}
                  3+
                {% endif %}
              </span>
            {% endwith %}
          </dt>

          <dd>₦{{ session.total_amount|intcomma }}</dd>
        </div>
      </dl>
    </div>

    <!-- Selected Fees -->
    <section>
      <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-4 flex items-center gap-2">
        <i data-lucide="list" class="w-5 h-5"></i>
        Selected Fees
      </h3>
      <ul class="space-y-3">
        {% for fee in fees %}
          <li class="flex items-center justify-between bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md px-4 py-2 shadow-sm">
            <div class="flex items-center gap-2 text-gray-800 dark:text-gray-200">
              <i data-lucide="badge-dollar-sign" class="w-5 h-5 text-blue-600 dark:text-blue-400"></i>
              {{ fee.name }}
            </div>
            <div class="relative w-16 h-1 mx-2 bg-gradient-to-r from-blue-400 to-indigo-500 rounded-full"></div>
            <div class="text-gray-900 dark:text-gray-100 font-medium">₦{{ fee.total|intcomma }}</div>
          </li>
        {% empty %}
          <li class="text-gray-500 dark:text-gray-400 italic">No fees selected.</li>
        {% endfor %}
      </ul>
    </section>

    <!-- Upload Proof -->
    <form method="POST" enctype="multipart/form-data" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md space-y-6">
      {% csrf_token %}
      <div>
        <label for="{{ form.proof_of_payment.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
          <i data-lucide="upload-cloud" class="inline w-4 h-4 mr-1"></i>
          {{ form.proof_of_payment.label }}
        </label>
        {{ form.proof_of_payment }}
        {% if form.proof_of_payment.help_text %}
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">{{ form.proof_of_payment.help_text }}</p>
        {% endif %}
        {% if form.proof_of_payment.errors %}
          <p class="text-sm text-red-600 dark:text-red-400 mt-1">{{ form.proof_of_payment.errors }}</p>
        {% endif %}
      </div>

      <!-- Optional Preview (Optional JS Hookpoint) -->
      <div id="upload-preview" class="hidden">
        <p class="text-xs text-gray-500 dark:text-gray-400">Preview of uploaded file:</p>
        <img id="preview-image" class="mt-2 max-h-48 rounded shadow" alt="Proof Preview">
      </div>
     
        <div id="file-preview" class="mt-2 text-sm text-gray-600 dark:text-gray-400"></div>

        <script>
        document.addEventListener('DOMContentLoaded', () => {
            const fileInput = document.getElementById('{{ form.proof_of_payment.id_for_label }}');
            const preview = document.getElementById('file-preview');
            fileInput.addEventListener('change', () => {
            const file = fileInput.files[0];
            if (!file) {
                preview.textContent = '';
                return;
            }
            preview.textContent = `Selected file: ${file.name}`;
            // Optionally: show image preview if image file
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = e => {
                preview.innerHTML = `<img src="${e.target.result}" alt="File preview" class="max-w-xs max-h-48 rounded mt-2" />`;
                };
                reader.readAsDataURL(file);
            }
            });
        });
        </script>


      <button type="submit" class="w-full py-3 bg-green-600 hover:bg-green-700 rounded-md text-white font-semibold transition">
        Submit Proof of Payment
      </button>
    </form>
  </div>
</section>
{% endblock %}